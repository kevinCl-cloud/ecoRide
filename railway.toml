# railway.toml

[build]
builder = "NIXPACKS"
buildCommand = "export COMPOSER_ALLOW_SUPERUSER=1 && composer install --no-dev --prefer-dist --no-interaction --optimize-autoloader --no-scripts"

[deploy]
preDeployCommand = "bash -lc 'for i in {1..40}; do php bin/console doctrine:migrations:migrate --no-interaction --allow-no-migration --env=prod && exit 0; echo \"Waiting for DB... ($i/40)\"; sleep 2; done; echo \"DB still not reachable\"; exit 1'"
startCommand = "php -S 0.0.0.0:${PORT} -t public"

